<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Whala — AI for Everyone</title>
  <meta name="description" content="Whala is devoted to making AI accessible, safe, and free — with a focus on people with disabilities such as visual impairment and blindness." />
  <meta name="theme-color" content="#0b0b14" />
  
  <!-- Typography: system stack for performance & user familiarity -->
  <style>
    :root {
      --bg: #0b0b14;           /* deep ink */
      --bg-soft: #0f1120;      /* panel */
      --text: #f7f7fb;         /* near-white */
      --muted: #b9b9c9;        /* soft gray */
      --brand: #7ad8ff;        /* cyan */
      --brand-2: #b07cff;      /* violet */
      --accent: #64ffa1;       /* mint */
      --danger: #ff5a84;       /* coral */
      --focus: #ffe084;        /* warm focus ring */
      --card: rgba(255,255,255,0.06);
      --blur: blur(12px);
      --radius-xl: 22px;
      --radius-xxl: 30px;
      --shadow-1: 0 10px 30px rgba(0,0,0,0.25);
      --shadow-2: 0 20px 60px rgba(0,0,0,0.4);
      --grid: 88px;            /* rhythm unit for geometry */
      --speed-1: 800ms;
      --speed-2: 1400ms;
      --speed-3: 2200ms;
      --font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: var(--font-sans);
      color: var(--text);
      background: radial-gradient(1200px 800px at 10% -10%, rgba(122,216,255,0.12), transparent 55%),
                  radial-gradient(1200px 800px at 110% 10%, rgba(176,124,255,0.12), transparent 55%),
                  radial-gradient(900px 600px at 50% 120%, rgba(100,255,161,0.08), transparent 60%),
                  var(--bg);
      overflow-x: hidden;
    }

    /* Skip to content for screen-reader & keyboard users */
    .skip-link {
      position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden;
    }
    .skip-link:focus {
      left: 12px; top: 12px; width: auto; height: auto; padding: 10px 14px; z-index: 2000;
      background: var(--brand-2); color: #0b0620; border-radius: 10px; outline: none;
      box-shadow: var(--shadow-2);
    }

    /* Top navigation */
    header {
      position: sticky; top: 0; z-index: 1000; backdrop-filter: saturate(1.2) blur(10px);
      background: linear-gradient(180deg, rgba(11,11,20,0.78), rgba(11,11,20,0.44));
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .nav {
      max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between;
      padding: 14px 20px;
    }
    .brand { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text); }
    .brand img { width: 42px; height: 42px; border-radius: 10px; object-fit: contain; background: rgba(255,255,255,0.04); padding: 6px; }
    .brand strong { letter-spacing: 0.6px; font-weight: 800; }

    .nav a.link { color: var(--muted); text-decoration: none; margin-left: 20px; font-weight: 600; }
    .nav a.link:hover, .nav a.link:focus { color: var(--text); outline: none; }

    .controls { display: flex; gap: 10px; align-items: center; }
    .ctrl-btn {
      border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.04); color: var(--text);
      padding: 8px 12px; border-radius: 12px; cursor: pointer; font-size: 14px; font-weight: 700;
    }
    .ctrl-btn:focus { outline: 3px solid var(--focus); outline-offset: 2px; }

    /* Hero */
    .hero {
      position: relative; isolation: isolate;
      max-width: 1200px; margin: 0 auto; padding: 80px 20px 60px;
    }
    .hero-grid {
      display: grid; grid-template-columns: 1.15fr 0.85fr; gap: 28px; align-items: center;
    }
    .headline {
      font-size: clamp(42px, 7vw, 88px);
      line-height: 0.98; font-weight: 900; letter-spacing: -0.02em;
      background: linear-gradient(180deg, #fff, #b9c6ff 45%, #a7ffd7 100%);
      -webkit-background-clip: text; background-clip: text; color: transparent;
      text-wrap: balance;
    }
    .kicker { font-size: clamp(16px, 2.2vw, 20px); color: var(--muted); max-width: 58ch; margin-top: 16px; }

    .geom-stage { position: relative; height: min(60vh, 520px); border-radius: var(--radius-xxl);
      background: linear-gradient(160deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.1); overflow: hidden; box-shadow: var(--shadow-1);
    }
    .orb, .tri, .sq {
      position: absolute; opacity: 0.85; filter: drop-shadow(0 8px 18px rgba(0,0,0,0.4));
      will-change: transform; transform: translateZ(0);
    }
    .orb { width: 110px; height: 110px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0) 60%),
                                       radial-gradient(circle at 70% 70%, var(--brand), rgba(122,216,255,0.05));
      mix-blend-mode: screen; animation: floatY var(--speed-3) ease-in-out infinite alternate;
    }
    .tri { width: 0; height: 0; border-left: 64px solid transparent; border-right: 64px solid transparent; border-bottom: 110px solid var(--brand-2);
      filter: drop-shadow(0 12px 30px rgba(176,124,255,0.35)); opacity: 0.8; animation: floatX var(--speed-2) ease-in-out infinite alternate;
    }
    .sq { width: 110px; height: 110px; border-radius: 18px; background: conic-gradient(from 180deg at 50% 50%, rgba(100,255,161,0.95), rgba(122,216,255,0.7), rgba(176,124,255,0.9));
      transform: rotate(18deg); animation: drift var(--speed-1) linear infinite;
    }

    .halo {
      position: absolute; inset: -30%; background: radial-gradient(closest-side, rgba(122,216,255,0.22), transparent 70%);
      mask: radial-gradient(closest-side, black, transparent 70%);
      pointer-events: none; animation: pulse 6s ease-in-out infinite;
    }

    @keyframes floatY { from { transform: translateY(-14px); } to { transform: translateY(20px); } }
    @keyframes floatX { from { transform: translateX(-18px); } to { transform: translateX(22px); } }
    @keyframes drift { from { transform: translate(0,0) rotate(18deg); } to { transform: translate(10px,-8px) rotate(378deg); } }
    @keyframes pulse { 0%,100%{ opacity: 0.4;} 50%{ opacity: 0.9; } }

    /* Quote */
    .quote { text-align: center; padding: 24px 20px 56px; font-size: clamp(18px, 2.2vw, 24px); color: #dfe8ff;
      font-weight: 800; letter-spacing: 0.3px; }

    /* Philosophy cards */
    .cards {
      max-width: 1200px; margin: 0 auto; padding: 0 20px 80px; display: grid; gap: 24px;
      grid-template-columns: repeat(3, minmax(240px, 1fr)); perspective: 1200px;
    }
    .card {
      position: relative; border-radius: var(--radius-xl); background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
      border: 1px solid rgba(255,255,255,0.12); padding: 22px; box-shadow: var(--shadow-1); transform-style: preserve-3d;
      transition: transform 600ms ease, box-shadow 600ms ease, background 600ms ease;
    }
    .card:hover { transform: translateY(-8px) rotateX(6deg) rotateY(-6deg); box-shadow: var(--shadow-2);
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06)); }
    .card h3 { margin: 0 0 10px; font-size: 22px; letter-spacing: 0.4px; }
    .card p { margin: 0; color: var(--muted); line-height: 1.6; }
    .card .glyph { position: absolute; right: 16px; top: 16px; opacity: 0.45; font-family: var(--font-mono); font-weight: 800; }

    /* Section header */
    section { scroll-margin-top: 100px; }
    .section {
      max-width: 1200px; margin: 0 auto; padding: 80px 20px; position: relative;
    }
    .section h2 { font-size: clamp(28px, 3.8vw, 42px); margin: 0 0 14px; letter-spacing: 0.2px; }
    .section p.lead { color: var(--muted); font-size: 18px; max-width: 70ch; }

    /* Mission: animated entrants from all sides */
    .mission-grid { display: grid; grid-template-columns: 1.1fr 0.9fr; gap: 24px; align-items: start; }
    .mission-art { position: relative; height: 380px; border-radius: var(--radius-xxl); background: var(--card);
      border: 1px solid rgba(255,255,255,0.12); overflow: hidden; }
    .cloud { position: absolute; width: 220px; height: 100px; background: radial-gradient(closest-side, rgba(255,255,255,0.5), rgba(255,255,255,0.12));
      filter: blur(8px); border-radius: 50px; opacity: 0.7; animation: glide 22s linear infinite; }
    .cloud.one { left: -20%; top: 20%; }
    .cloud.two { left: -30%; top: 60%; animation-duration: 28s; }
    .cloud.three { left: -25%; top: 40%; animation-duration: 26s; }
    @keyframes glide { from { transform: translateX(0); } to { transform: translateX(180%); } }

    .burst { position: absolute; inset: 0; pointer-events: none; }
    .burst::before, .burst::after {
      content: ""; position: absolute; border: 1px dashed rgba(255,255,255,0.18); border-radius: 50%;
      inset: 18% 18% 18% 18%; animation: pop 6s ease-in-out infinite;
    }
    .burst::after { inset: 8% 8% 8% 8%; animation-delay: 1.8s; }
    @keyframes pop { 0%,100%{ transform: scale(1); opacity: 0.4;} 50%{ transform: scale(1.08); opacity: 0.9;} }

    .checklist { display: grid; gap: 12px; }
    .check { display: grid; grid-template-columns: 28px 1fr; gap: 10px; align-items: start; }
    .tick { width: 22px; height: 22px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), #b8ffda);
      display: inline-grid; place-items: center; color: #054226; font-weight: 900; }

    /* Research: side-scroll planets carousel */
    .orbit-wrap { position: relative; border-radius: var(--radius-xxl); background: var(--card); border: 1px solid rgba(255,255,255,0.12);
      overflow: hidden; }
    .orbit {
      display: grid; grid-auto-flow: column; grid-auto-columns: 100%; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none;
    }
    .orbit::-webkit-scrollbar { display: none; }
    .planet { position: relative; scroll-snap-align: center; min-height: 420px; padding: 36px; display: grid; grid-template-columns: 1fr 1.1fr; gap: 24px; }
    .planet .ball { width: 220px; height: 220px; border-radius: 50%; background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0) 60%),
                    radial-gradient(circle at 70% 70%, var(--brand-2), rgba(176,124,255,0.12));
      box-shadow: 0 0 0 2px rgba(255,255,255,0.12), 0 30px 70px rgba(0,0,0,0.45); align-self: center; justify-self: center;
      animation: floatY 3.4s ease-in-out infinite alternate; }
    .planet h3 { margin: 8px 0 8px; font-size: 26px; }
    .planet p { color: var(--muted); }

    .orbit-indicators { position: absolute; bottom: 14px; left: 0; right: 0; display: flex; justify-content: center; gap: 8px; }
    .dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,0.22); }
    .dot.active { background: var(--brand); box-shadow: 0 0 0 2px rgba(122,216,255,0.35); }

    /* Projects: timeline */
    .timeline { position: relative; margin-top: 12px; }
    .timeline::before { content: ""; position: absolute; left: 18px; top: 0; bottom: 0; width: 3px; background: linear-gradient(180deg, var(--brand), var(--brand-2)); border-radius: 2px; }
    .step { position: relative; margin-left: 54px; padding: 18px 18px 18px 18px; border-radius: 18px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      box-shadow: var(--shadow-1); }
    .step::before { content: ""; position: absolute; left: -44px; top: 16px; width: 28px; height: 28px; border-radius: 50%; background: var(--bg-soft);
      border: 3px solid var(--accent); box-shadow: 0 0 0 6px rgba(100,255,161,0.15); }
    .step h4 { margin: 0 0 6px; font-size: 20px; }
    .mono { font-family: var(--font-mono); color: #e7ffe9; }

    .cta {
      margin-top: 24px; display: inline-flex; align-items: center; gap: 10px; text-decoration: none; font-weight: 900; letter-spacing: 0.4px;
      background: linear-gradient(135deg, var(--brand), var(--accent)); color: #042016; padding: 14px 18px; border-radius: 14px;
      box-shadow: 0 14px 34px rgba(100,255,161,0.25), 0 10px 26px rgba(122,216,255,0.18); border: 0;
    }
    .cta:focus { outline: 3px solid var(--focus); outline-offset: 3px; }

    /* Footer */
    footer { margin-top: 80px; border-top: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.02); }
    .footer-inner { max-width: 1200px; margin: 0 auto; padding: 28px 20px; display: grid; grid-template-columns: 1fr auto; gap: 10px; }
    .small { color: var(--muted); font-size: 14px; }

    /* Reveal animations */
    .reveal { opacity: 0; transform: translateY(24px); transition: transform 800ms ease, opacity 800ms ease; }
    .reveal.in { opacity: 1; transform: none; }

    /* Focus styles for a11y */
    :focus-visible { outline: 3px solid var(--focus); outline-offset: 2px; border-radius: 8px; }

    /* Responsive */
    @media (max-width: 960px) {
      .hero-grid, .mission-grid, .planet { grid-template-columns: 1fr; }
      .geom-stage { height: 46vh; }
      .planet { min-height: 520px; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
    }
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>

  <header role="banner" aria-label="Main Navigation">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="#" aria-label="Whala home">
        <img src="logo.png" alt="Whala logo" />
        <strong>Whala</strong>
      </a>
      <div>
        <a class="link" href="application.html">Our Application</a>
        <a class="link" href="#projects">Projects</a>
        <a class="link" href="#mission">Our Mission</a>
        <a class="link" href="#research">Research</a>
        <a class="link" href="chatbot.html">Chatbot Application</a>

      </div>
      <div class="controls">
        <button class="ctrl-btn" id="contrastToggle" aria-pressed="false">High Contrast</button>
        <button class="ctrl-btn" id="textToggle" aria-pressed="false">A+ Text</button>
        <button class="ctrl-btn" id="motionToggle" aria-pressed="false">Reduce Motion</button>
      </div>
    </nav>
  </header>

  <main id="main" tabindex="-1">
    <!-- HERO -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-grid">
        <div>
          <h1 id="hero-title" class="headline">AI for everyone. Accessible, safe and free.</h1>
          <p class="kicker">We're Whala, devoted to foster AI accessibility for all people. We are delving deep into research on how machine learning can diagnose eye illnesses and cure blindness, actively seeking solutions for how to make AI accessible to visually-impaired people and aren't hand waving on AI safety either.</p>
        </div>
        <div class="geom-stage" aria-hidden="true">
          <div class="halo"></div>
          <div class="orb" style="left: 8%; top: 16%;"></div>
          <div class="tri" style="left: 62%; top: 12%;"></div>
          <div class="sq"  style="left: 24%; bottom: 10%;"></div>
          <svg class="wires" width="100%" height="100%" viewBox="0 0 1200 520" preserveAspectRatio="none" style="position:absolute; inset:0; opacity:0.5;">
            <defs>
              <linearGradient id="wireG" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="rgba(122,216,255,0.0)"/>
                <stop offset="50%" stop-color="rgba(122,216,255,0.5)"/>
                <stop offset="100%" stop-color="rgba(176,124,255,0.0)"/>
              </linearGradient>
            </defs>
            <path d="M0,120 C200,40 400,200 600,120 800,40 1000,220 1200,140" stroke="url(#wireG)" stroke-width="2" fill="none"/>
            <path d="M0,260 C220,210 420,340 620,260 840,180 1020,320 1200,280" stroke="url(#wireG)" stroke-width="2" fill="none"/>
            <path d="M0,400 C240,360 420,420 640,380 860,340 1000,420 1200,420" stroke="url(#wireG)" stroke-width="2" fill="none"/>
          </svg>
        </div>
      </div>
    </section>

    <div class="quote" aria-label="Whala principle">“Let AI make AI accessible.”</div>

    <!-- PHILOSOPHY CARDS -->
    <section class="cards" aria-label="Philosophies">
      <article class="card reveal" aria-labelledby="ph1"><span class="glyph">01</span>
        <h3 id="ph1">Safety</h3>
        <p>We design with a safety-first mindset: transparent model behavior, red-team driven evals, and human-in-the-loop review.
           Accessibility means trust — we bake in robust guardrails without compromising utility.</p>
      </article>
      <article class="card reveal" aria-labelledby="ph2"><span class="glyph">02</span>
        <h3 id="ph2">Accessibility</h3>
        <p>Inclusive by default: screen reader-perfect semantics, high-contrast modes, scalable type, alt-first imagery, and multimodal I/O.
           We obsess over UX for the visually-impaired community.</p>
      </article>
      <article class="card reveal" aria-labelledby="ph3"><span class="glyph">03</span>
        <h3 id="ph3">Free!</h3>
        <p>Core access should never be gated. We commit to a generous free tier for essential assistive capabilities — because access is a right, not a perk.</p>
      </article>
    </section>

    <!-- MISSION -->
    <section id="mission" class="section" aria-labelledby="mission-h">
      <h2 id="mission-h" class="reveal">Our Mission</h2>
      <p class="lead reveal">We advance assistive intelligence so that anyone — regardless of visual ability — can understand, create, and thrive with AI. We partner with clinicians, ethicists, and affected communities to solve real problems with real-world rigor.</p>

      <div class="mission-grid" style="margin-top: 22px;">
        <div class="mission-art reveal" aria-hidden="true">
          <div class="cloud one"></div>
          <div class="cloud two"></div>
          <div class="cloud three"></div>
          <div class="burst"></div>
        </div>
        <div class="checklist reveal" role="list">
          <div class="check" role="listitem"><span class="tick">✓</span>
            <div><strong>Clinical impact</strong><br/><span class="muted">Tools that help detect eye conditions earlier and more accurately.</span></div>
          </div>
          <div class="check" role="listitem"><span class="tick">✓</span>
            <div><strong>Accessible by design</strong><br/><span class="muted">Everything we ship works with screen readers and keyboard-only use.</span></div>
          </div>
          <div class="check" role="listitem"><span class="tick">✓</span>
            <div><strong>Open knowledge</strong><br/><span class="muted">We share datasets, benchmarks, and methods whenever possible.</span></div>
          </div>
          <div class="check" role="listitem"><span class="tick">✓</span>
            <div><strong>Safety never optional</strong><br/><span class="muted">Rigorous evals + incident response to keep users safe.</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- RESEARCH - PLANETS CAROUSEL -->
    <section id="research" class="section" aria-labelledby="research-h">
      <h2 id="research-h" class="reveal">Research</h2>
      <p class="lead reveal">We explore computer vision for ocular health, accessible interaction design, and alignment techniques tuned for assistive contexts. Below, orbit through a few themes.</p>

      <div class="orbit-wrap reveal" aria-roledescription="carousel" aria-label="Research themes">
        <div class="orbit" id="orbit" role="group">
          <div class="planet" aria-label="Theme: Vision for Eyes">
            <div class="ball" aria-hidden="true"></div>
            <div>
              <h3>Learning to See — for Sight</h3>
              <p>From retinal fundus images to OCT volumes, we build <span class="mono">CNN</span>-based detectors of biomarkers associated with diabetic retinopathy, glaucoma and AMD — prioritizing calibration, uncertainty, and shift-robustness.
              </p>
            </div>
          </div>
          <div class="planet" aria-label="Theme: Interaction & Access">
            <div class="ball" style="background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0) 60%), radial-gradient(circle at 70% 70%, var(--brand), rgba(122,216,255,0.12));" aria-hidden="true"></div>
            <div>
              <h3>Interfaces You Can Hear & Feel</h3>
              <p>Lightweight VLM/LLMs paired with automatic TTS, earcons, and haptics so that complex visuals become comprehensible narratives for low-vision users.</p>
            </div>
          </div>
          <div class="planet" aria-label="Theme: Alignment & Safety">
            <div class="ball" style="background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,0) 60%), radial-gradient(circle at 70% 70%, #64ffa1, rgba(100,255,161,0.12));" aria-hidden="true"></div>
            <div>
              <h3>Assistive Alignment</h3>
              <p>Task plans optimized with principled search — combining clinician guidance, user goals, and guardrails to recommend safe, personalized next steps.</p>
            </div>
          </div>
        </div>
        <div class="orbit-indicators" aria-hidden="true">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>
    </section>

    <!-- PROJECTS -->
    <section id="projects" class="section" aria-labelledby="projects-h">
      <h2 id="projects-h" class="reveal">Projects</h2>
      <p class="lead reveal">Whala, we believe that the true solution doesn't come<br/>
        through one single primitive, but a synergy, an entire system<br/> of algorithms used in tandem.</p>

      <div class="timeline">
        <article class="step reveal">
          <h4>First… A focused visual model</h4>
          <p>We train a <strong>20 million parameter Convolutional NN</strong> on real biomarkers and eye disease datasets to help doctors diagnose and treat blind/visually-impaired patients.</p>
        </article>
        <article class="step reveal">
          <h4>Second… Natural language + speech</h4>
          <p>We use a <strong>lightweight VLM/LLM</strong> with automatic <strong>TTS</strong> for accessibility, summarizing visual content and enabling conversational assistance.</p>
        </article>
        <article class="step reveal">
          <h4>Third… Planning for the long run</h4>
          <p>For insights, the VLM/LLM has access to the CNN's prediction on the user, then uses an <strong>MCTS</strong> algorithm to assess the <em>best course of action</em> for the user in the future — both in health and in accessibility.</p>
        </article>
      </div>

      <a class="cta" href="application.html" aria-label="Open Whala application">Open the Application →</a>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="footer-inner">
      <div class="small">© <span id="year"></span> Whala. Building accessible AI.
        <span aria-hidden="true">•</span> <a class="link" href="#mission">Mission</a>
        <span aria-hidden="true">•</span> <a class="link" href="#research">Research</a>
        <span aria-hidden="true">•</span> <a class="link" href="#projects">Projects</a>
      </div>
      <div class="small">Made with care for screen readers & keyboards ♿</div>
    </div>
  </footer>

  <!-- Minimal JS for interactivity & accessibility controls -->
  <script>
    // Set dynamic year
    document.getElementById('year').textContent = new Date().getFullYear();

    // IntersectionObserver for reveal animations
    const io = new IntersectionObserver((entries) => {
      entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('in'); });
    }, { threshold: 0.16 });
    document.querySelectorAll('.reveal').forEach(el => io.observe(el));

    // Orbit carousel indicators
    const orbit = document.getElementById('orbit');
    const dots = document.querySelectorAll('.dot');
    function updateDots() {
      const i = Math.round(orbit.scrollLeft / orbit.clientWidth);
      dots.forEach((d, idx) => d.classList.toggle('active', idx === i));
    }
    orbit.addEventListener('scroll', updateDots, { passive: true });
    updateDots();

    // Controls: high contrast, text size, reduce motion toggles (persisted)
    const root = document.documentElement;
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)');

    const contrastToggle = document.getElementById('contrastToggle');
    const textToggle = document.getElementById('textToggle');
    const motionToggle = document.getElementById('motionToggle');

    const applyPrefs = () => {
      const hc = localStorage.getItem('whala_hc') === '1';
      const lg = localStorage.getItem('whala_lg') === '1';
      const rm = localStorage.getItem('whala_rm') === '1' || prefersReduced.matches;

      contrastToggle.setAttribute('aria-pressed', hc);
      textToggle.setAttribute('aria-pressed', lg);
      motionToggle.setAttribute('aria-pressed', rm);

      root.style.setProperty('--bg', hc ? '#000' : '#0b0b14');
      root.style.setProperty('--text', hc ? '#fff' : '#f7f7fb');
      root.style.setProperty('--muted', hc ? '#eaeaea' : '#b9b9c9');
      document.body.style.fontSize = lg ? '18px' : '';

      document.querySelectorAll('*').forEach(el => {
        if (rm) {
          el.style.animation = 'none';
          el.style.transition = 'none';
        } else {
          el.style.animation = '';
          el.style.transition = '';
        }
      });
    };

    contrastToggle.addEventListener('click', () => {
      const v = localStorage.getItem('whala_hc') === '1' ? '0' : '1';
      localStorage.setItem('whala_hc', v); applyPrefs();
    });
    textToggle.addEventListener('click', () => {
      const v = localStorage.getItem('whala_lg') === '1' ? '0' : '1';
      localStorage.setItem('whala_lg', v); applyPrefs();
    });
    motionToggle.addEventListener('click', () => {
      const base = localStorage.getItem('whala_rm') === '1';
      localStorage.setItem('whala_rm', base ? '0' : '1'); applyPrefs();
    });

    applyPrefs();

    // Subtle parallax on hero geometry (mouse move)
    const stage = document.querySelector('.geom-stage');
    const movers = stage.querySelectorAll('.orb, .tri, .sq');
    stage.addEventListener('pointermove', (e) => {
      const r = stage.getBoundingClientRect();
      const x = (e.clientX - r.left) / r.width - 0.5;
      const y = (e.clientY - r.top) / r.height - 0.5;
      movers.forEach((el, i) => {
        const depth = (i + 1) * 8;
        el.style.transform = `translate(${x*depth}px, ${y*depth}px)`;
      });
    });
    stage.addEventListener('pointerleave', () => movers.forEach(el => el.style.transform = ''));    

    // Keyboard shortcuts: Left/Right to navigate research carousel when focused
    document.getElementById('research-h').setAttribute('tabindex', '-1');
    orbit.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') orbit.scrollBy({ left: orbit.clientWidth, behavior: 'smooth' });
      if (e.key === 'ArrowLeft') orbit.scrollBy({ left: -orbit.clientWidth, behavior: 'smooth' });
    });
  </script>
</body>
</html>
